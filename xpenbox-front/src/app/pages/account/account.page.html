<div class="h-screen xpb-bg-main p-3 sm:p-4 flex flex-col overflow-hidden">
  <!-- Header -->
  <div class="mb-4 flex-shrink-0">
    <h1 class="text-xl sm:text-2xl font-bold xpb-text-primary mb-1">Mis Cuentas</h1>
    <p class="xpb-text-secondary text-sm">Gestiona tus cuentas y tarjetas de crédito</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-2 sm:grid-cols-2 gap-3 mb-4 flex-shrink-0">
    <!-- Total Liquidity -->
    <app-summary-card
      [isLoading]="accountState.isLoadingGetList()"
      [titleCard]="'Liquidez Total'"
      [contentCard]="accountState.totalLiquidBalance() | currency:'PEN ':'symbol':'1.2-2'"
      [subtitleCard]="
        accountState.accounts().length > 1 ? accountState.accounts().length + ' cuentas activas' :
        accountState.accounts().length == 1 ? accountState.accounts().length + ' cuenta activa' :
        'Ninguna cuenta activa'
      "
      [iconCard]="'account_balance'"
      [contentClassCard]="'xpb-text-income'"
    ></app-summary-card>

    <!-- Total Credit Balance -->
    <app-summary-card
      [isLoading]="this.creditCardState.isLoadingGetList()"
      [titleCard]="'Balance Total Tarjetas'"
      [contentCard]="
        '- ' + (this.creditCardState.totalCreditBalance() | currency:'PEN ':'symbol':'1.2-2')
      "
      [subtitleCard]="
        this.creditCardState.creditCards().length > 1 ? this.creditCardState.creditCards().length + ' tarjetas activas' :
        this.creditCardState.creditCards().length == 1 ? this.creditCardState.creditCards().length + ' tarjeta activa' :
        'Ninguna tarjeta activa'
      "
      [iconCard]="'credit_card'"
      [contentClassCard]="'xpb-text-expense'"
    ></app-summary-card>
  </div>

  <!-- Two Column/Row Layout with Independent Scroll -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-5 flex-1 min-h-0">
    <!-- Bank Accounts Section -->
    <section class="flex flex-col h-full overflow-hidden">
      <div class="flex items-center justify-between mb-3 flex-shrink-0">
        <h2 class="text-lg sm:text-xl font-semibold xpb-text-primary flex items-center gap-2">
          <span class="material-icons text-xl sm:text-2xl">account_balance</span>
          Cuentas
        </h2>
        <button 
          (click)="openAccountEditionModal()"
          class="flex items-center gap-1.5 px-3 py-2 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors text-sm"
          type="button">
          <span class="material-icons text-lg">add</span>
          <span class="hidden sm:inline">Nueva</span>
        </button>
      </div>

    <!-- Bank Accounts List -->
    <div class="space-y-3 overflow-y-auto pr-2 flex-1 min-h-0">
      @if (this.accountState.isLoadingGetList()) {
        <app-loading-ui></app-loading-ui>
      } @else if (this.accountState.errorGetList()) {
        <app-retry-component
          [message]="'No se encontraron cuentas'"
          (retry)="reloadAccounts()">
        </app-retry-component>
      } @else if (this.accountState.accounts().length === 0) {
        <app-create-first-component
          [icon]="'account_balance'"
          [title]="'No hay cuentas'"
          [subtitle]="'Comienza creando tu primera cuenta para organizar tus ingresos y gastos'"
          [buttonText]="'Crear Primera Cuenta'"
          (create)="openAccountEditionModal()"
        ></app-create-first-component>
      } @else {
        @for (account of this.accountState.accounts(); track account.resourceCode) {
          <app-account-card ngSkipHydration class="block"
            [accountCardName]="account.name"
            [accountCardBalance]="account.balance"
            [accountCardState]="account.state"
            [accountCardResourceCode]="account.resourceCode"
            (accountCardEdit) = "openAccountEditionModal($event)"
            (accountCardTransfer) = "openTransferModal($event)"
          ></app-account-card>
        }
      }
    </div>
  </section>

    <!-- Credit Cards Section -->
    <section class="flex flex-col h-full overflow-hidden">
      <div class="flex items-center justify-between mb-3 flex-shrink-0">
        <h2 class="text-lg sm:text-xl font-semibold xpb-text-primary flex items-center gap-2">
          <span class="material-icons text-xl sm:text-2xl">credit_card</span>
          Tarjetas de Crédito
        </h2>
        <button 
          (click)="openCreditCardEditionModal()"
          class="flex items-center gap-1.5 px-3 py-2 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors text-sm"
          type="button">
          <span class="material-icons text-lg">add</span>
          <span class="hidden sm:inline">Nueva</span>
        </button>
      </div>

      <!-- Credit Cards List -->
      <div class="space-y-3 overflow-y-auto pr-2 flex-1 min-h-0">
        @if (this.creditCardState.isLoadingGetList()) {
          <app-loading-ui></app-loading-ui>
        } @else if (this.creditCardState.errorGetList()) {
          <app-retry-component
            [message]="'No se encontraron tarjetas'"
            (retry)="reloadCreditCards()">
          </app-retry-component>
        } @else if (this.creditCardState.creditCards().length === 0) {
          <app-create-first-component
            [icon]="'credit_card'"
            [title]="'No hay tarjetas'"
            [subtitle]="'Comienza creando tu primera tarjeta para organizar tus gastos'"
            [buttonText]="'Crear Primera Tarjeta'"
            (create)="openCreditCardEditionModal()"
          ></app-create-first-component>
        } @else {
          @for (creditCard of this.creditCardState.creditCards(); track creditCard.resourceCode) {
            <app-credit-card ngSkipHydration class="block"
              [creditCardName]="creditCard.name"
              [creditCardLimit]="creditCard.creditLimit"
              [creditCardBalance]="creditCard.currentBalance"
              [creditCardState]="creditCard.state"
              [creditCardBillingDay]="creditCard.billingDay"
              [creditCardPaymentDay]="creditCard.paymentDay"
              [creditCardResourceCode]="creditCard.resourceCode"
              (creditCardEdit) = "openCreditCardEditionModal($event)"
              (creditCardPayment) = "openCreditcardPaymentModal($event)"
            ></app-credit-card>
          }
        }
      </div>
    </section>
  </div>
</div>

@if (showAccountEditionModal()) {
  <app-account-edition-modal (close)="closeAccountEditionModal()" [resourceCodeSelected]="resourceCodeAccountSelected()"></app-account-edition-modal>
}

@if (showCreditCardEditionModal()) {
  <app-creditcard-edition-modal (close)="closeCreditCardEditionModal()" [resourceCodeSelected]="resourceCodeCreditCardSelected()"></app-creditcard-edition-modal>
}

@if (showTransferModal()) {
  <app-transfer-modal (close)="closeTransferModal()" [accountResourceCode]="resourceCodeTransferSelected()"></app-transfer-modal>
}

@if (showCreditcardPaymentModal()) {
  <app-creditcard-payment-modal (close)="closeCreditcardPaymentModal()" [creditCardResourceCode]="resourceCodeCreditcardPaymentSelected()"></app-creditcard-payment-modal>
}