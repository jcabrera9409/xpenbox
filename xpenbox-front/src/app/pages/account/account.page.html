<div class="min-h-screen xpb-bg-main p-3 sm:p-4">
  <!-- Header -->
  <div class="mb-4">
    <h1 class="text-xl sm:text-2xl font-bold xpb-text-primary mb-1">Mis Cuentas</h1>
    <p class="xpb-text-secondary text-sm">Gestiona tus cuentas y tarjetas de crédito</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">
    <!-- Total Liquidity -->
    <div class="xpb-bg-card rounded-lg border border-[var(--xpb-border)] p-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs xpb-text-secondary mb-1">Liquidez Total</p>
          <p class="text-2xl sm:text-3xl font-bold xpb-text-income">
            @if (accountState.isLoading()) {
              Cargando...
            } @else {
              {{ accountState.totalLiquidBalance() | currency:'PEN ':'symbol':'1.2-2' }}
            }
          </p>
          <p class="text-xs xpb-text-secondary mt-1">
            @if (accountState.isLoading()) {
              ...
            } @else {
              @if (accountState.accounts().length > 1) {
                {{ accountState.accounts().length }} cuentas activas
              } @else if (accountState.accounts().length == 1) {
                {{ accountState.accounts().length }} cuenta activa
              } @else {
                Ninguna cuenta activa
              }
            }
          </p>
        </div>
        <div class="w-12 h-12 rounded-full bg-[var(--xpb-bg-sidebar)] flex items-center justify-center">
          <span class="material-icons xpb-text-income text-2xl">account_balance</span>
        </div>
      </div>
    </div>

    <!-- Total Credit Balance -->
    <div class="xpb-bg-card rounded-lg border border-[var(--xpb-border)] p-4">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs xpb-text-secondary mb-1">Balance Total Tarjetas</p>
          <p class="text-2xl sm:text-3xl font-bold xpb-text-expense">
            @if (creditCardState.isLoading()) {
              Cargando...
            } @else {
              - {{ creditCardState.totalCreditBalance() | currency:'PEN ':'symbol':'1.2-2' }}
            }
          </p>
          <p class="text-xs xpb-text-secondary mt-1">
            @if (creditCardState.isLoading()) {
              ...
            } @else {
              @if (creditCardState.creditCards().length > 1) {
                {{ creditCardState.creditCards().length }} tarjetas activas
              } @else if (creditCardState.creditCards().length == 1) {
                {{ creditCardState.creditCards().length }} tarjeta activa
              } @else {
                Ninguna tarjeta activa
              }
            }
          </p>
        </div>
        <div class="w-12 h-12 rounded-full bg-[var(--xpb-bg-sidebar)] flex items-center justify-center">
          <span class="material-icons xpb-text-expense text-2xl">credit_card</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Two Column/Row Layout with Independent Scroll -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-5 h-[calc(100vh-220px)] sm:h-[calc(100vh-240px)]">
    <!-- Bank Accounts Section -->
    <section class="flex flex-col min-h-0">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg sm:text-xl font-semibold xpb-text-primary flex items-center gap-2">
          <span class="material-icons text-xl sm:text-2xl">account_balance</span>
          Cuentas
        </h2>
        <button 
          (click)="openAccountEditionModal()"
          class="flex items-center gap-1.5 px-3 py-2 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors text-sm"
          type="button">
          <span class="material-icons text-lg">add</span>
          <span class="hidden sm:inline">Nueva</span>
        </button>
      </div>

    <!-- Bank Accounts List -->
    <div class="space-y-3 overflow-y-auto pr-2 flex-1">
      @if (accountState.isLoading()) {
        <div class="flex items-center justify-center py-16">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-black"></div>
            <p class="mt-4 text-neutral-600">Cargando cuentas...</p>
          </div>
        </div>
      } @else if (accountState.error()) {
        <div class="flex items-center justify-center py-16">
          <div class="text-center">
            <span class="material-icons text-6xl text-neutral-400">search_off</span>
            <p class="mt-4 text-neutral-600">No se encontraron cuentas</p>
          </div>
        </div>
      } @else {
        @for (account of accountState.accounts(); track account.resourceCode) {
          <app-account-card ngSkipHydration class="block"
            [accountCardName]="account.name"
            [accountCardBalance]="account.balance"
            [accountCardState]="account.state"
            [accountCardResourceCode]="account.resourceCode"
            (accountCardEdit) = "openAccountEditionModal($event)"
          ></app-account-card>
        }
      }
    </div>
  </section>

    <!-- Credit Cards Section -->
    <section class="flex flex-col min-h-0">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg sm:text-xl font-semibold xpb-text-primary flex items-center gap-2">
          <span class="material-icons text-xl sm:text-2xl">credit_card</span>
          Tarjetas de Crédito
        </h2>
        <button 
          class="flex items-center gap-1.5 px-3 py-2 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors text-sm"
          type="button">
          <span class="material-icons text-lg">add</span>
          <span class="hidden sm:inline">Nueva</span>
        </button>
      </div>

      <!-- Credit Cards List -->
      <div class="space-y-3 overflow-y-auto pr-2 flex-1">
        @if (creditCardState.isLoading()) {
          <div class="flex items-center justify-center py-16">
            <div class="text-center">
              <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-black"></div>
              <p class="mt-4 text-neutral-600">Cargando tarjetas...</p>
            </div>
          </div>
        } @else if (creditCardState.error()) {
          <div class="flex items-center justify-center py-16">
            <div class="text-center">
              <span class="material-icons text-6xl text-neutral-400">search_off</span>
              <p class="mt-4 text-neutral-600">No se encontraron tarjetas</p>
            </div>
          </div>
        } @else {
          @for (creditCard of creditCardState.creditCards(); track creditCard.resourceCode) {
            <app-credit-card ngSkipHydration class="block"
              [creditCardName]="creditCard.name"
              [creditCardLimit]="creditCard.creditLimit"
              [creditCardBalance]="creditCard.currentBalance"
              [creditCardState]="creditCard.state"
              [creditCardBillingDay]="creditCard.billingDay"
              [creditCardPaymentDay]="creditCard.paymentDay"
              [creditCardResourceCode]="creditCard.resourceCode"
            ></app-credit-card>
          }
        }
      </div>
    </section>
  </div>
</div>

@if (showAccountEditionModal()) {
  <app-account-edition-modal (close)="closeAccountEditionModal()" [resourceCodeSelected]="resourceCodeSelected()"></app-account-edition-modal>
}