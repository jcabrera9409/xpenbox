<div class="h-screen xpb-bg-main p-3 sm:p-4 flex flex-col overflow-hidden">
  <!-- Header -->
  <div class="mb-4 flex-shrink-0">
    <h1 class="text-xl sm:text-2xl font-bold xpb-text-primary mb-1">Mis Cuentas</h1>
    <p class="xpb-text-secondary text-sm">Gestiona tus cuentas y tarjetas de crédito</p>
  </div>

  <!-- Summary Cards -->
  <div class="grid grid-cols-2 sm:grid-cols-2 gap-3 mb-4 flex-shrink-0">
    <!-- Total Liquidity -->
    <app-summary-card
      [isLoading]="accountState.isLoading()"
      [titleCard]="'Liquidez Total'"
      [contentCard]="accountState.totalLiquidBalance() | currency:'PEN ':'symbol':'1.2-2'"
      [subtitleCard]="
        accountState.accounts().length > 1 ? accountState.accounts().length + ' cuentas activas' :
        accountState.accounts().length == 1 ? accountState.accounts().length + ' cuenta activa' :
        'Ninguna cuenta activa'
      "
      [iconCard]="'account_balance'"
      [contentClassCard]="'xpb-text-income'"
    ></app-summary-card>

    <!-- Total Credit Balance -->
    <app-summary-card
      [isLoading]="creditCardState.isLoading()"
      [titleCard]="'Balance Total Tarjetas'"
      [contentCard]="
        '- ' + (creditCardState.totalCreditBalance() | currency:'PEN ':'symbol':'1.2-2')
      "
      [subtitleCard]="
        creditCardState.creditCards().length > 1 ? creditCardState.creditCards().length + ' tarjetas activas' :
        creditCardState.creditCards().length == 1 ? creditCardState.creditCards().length + ' tarjeta activa' :
        'Ninguna tarjeta activa'
      "
      [iconCard]="'credit_card'"
      [contentClassCard]="'xpb-text-expense'"
    ></app-summary-card>
  </div>

  <!-- Two Column/Row Layout with Independent Scroll -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-5 flex-1 min-h-0">
    <!-- Bank Accounts Section -->
    <section class="flex flex-col h-full overflow-hidden">
      <div class="flex items-center justify-between mb-3 flex-shrink-0">
        <h2 class="text-lg sm:text-xl font-semibold xpb-text-primary flex items-center gap-2">
          <span class="material-icons text-xl sm:text-2xl">account_balance</span>
          Cuentas
        </h2>
        <button 
          (click)="openAccountEditionModal()"
          class="flex items-center gap-1.5 px-3 py-2 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors text-sm"
          type="button">
          <span class="material-icons text-lg">add</span>
          <span class="hidden sm:inline">Nueva</span>
        </button>
      </div>

    <!-- Bank Accounts List -->
    <div class="space-y-3 overflow-y-auto pr-2 flex-1 min-h-0">
      @if (accountState.isLoading()) {
        <app-loading-ui></app-loading-ui>
      } @else if (accountState.error()) {
        <div class="flex items-center justify-center py-16">
          <div class="text-center">
            <span class="material-icons text-6xl text-neutral-400">search_off</span>
            <p class="mt-4 text-neutral-600">No se encontraron cuentas</p>
            <button type="button"
              (click)="reloadAccounts()" 
              class="inline-block text-[var(--xpb-primary)] rounded-lg font-medium transition-colors text-sm">
              Reintentar
            </button>
          </div>
        </div>
      } @else {
        @for (account of accountState.accounts(); track account.resourceCode) {
          <app-account-card ngSkipHydration class="block"
            [accountCardName]="account.name"
            [accountCardBalance]="account.balance"
            [accountCardState]="account.state"
            [accountCardResourceCode]="account.resourceCode"
            (accountCardEdit) = "openAccountEditionModal($event)"
          ></app-account-card>
        }
      }
    </div>
  </section>

    <!-- Credit Cards Section -->
    <section class="flex flex-col h-full overflow-hidden">
      <div class="flex items-center justify-between mb-3 flex-shrink-0">
        <h2 class="text-lg sm:text-xl font-semibold xpb-text-primary flex items-center gap-2">
          <span class="material-icons text-xl sm:text-2xl">credit_card</span>
          Tarjetas de Crédito
        </h2>
        <button 
          (click)="openCreditCardEditionModal()"
          class="flex items-center gap-1.5 px-3 py-2 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors text-sm"
          type="button">
          <span class="material-icons text-lg">add</span>
          <span class="hidden sm:inline">Nueva</span>
        </button>
      </div>

      <!-- Credit Cards List -->
      <div class="space-y-3 overflow-y-auto pr-2 flex-1 min-h-0">
        @if (creditCardState.isLoading()) {
          <app-loading-ui></app-loading-ui>
        } @else if (creditCardState.error()) {
          <div class="flex items-center justify-center py-16">
            <div class="text-center">
              <span class="material-icons text-6xl text-neutral-400">search_off</span>
              <p class="mt-4 text-neutral-600">No se encontraron tarjetas</p>
              <button type="button"
                (click)="reloadCreditCards()" 
                class="inline-block text-[var(--xpb-primary)] rounded-lg font-medium transition-colors text-sm">
                Reintentar
              </button>
            </div>
          </div>
        } @else {
          @for (creditCard of creditCardState.creditCards(); track creditCard.resourceCode) {
            <app-credit-card ngSkipHydration class="block"
              [creditCardName]="creditCard.name"
              [creditCardLimit]="creditCard.creditLimit"
              [creditCardBalance]="creditCard.currentBalance"
              [creditCardState]="creditCard.state"
              [creditCardBillingDay]="creditCard.billingDay"
              [creditCardPaymentDay]="creditCard.paymentDay"
              [creditCardResourceCode]="creditCard.resourceCode"
              (creditCardEdit) = "openCreditCardEditionModal($event)"
            ></app-credit-card>
          }
        }
      </div>
    </section>
  </div>
</div>

@if (showAccountEditionModal()) {
  <app-account-edition-modal (close)="closeAccountEditionModal()" [resourceCodeSelected]="resourceCodeAccountSelected()"></app-account-edition-modal>
}

@if (showCreditCardEditionModal()) {
  <app-creditcard-edition-modal (close)="closeCreditCardEditionModal()" [resourceCodeSelected]="resourceCodeCreditCardSelected()"></app-creditcard-edition-modal>
}