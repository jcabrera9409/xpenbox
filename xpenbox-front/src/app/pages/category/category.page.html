<div class="h-screen xpb-bg-main p-3 sm:p-4 flex flex-col overflow-hidden">
  <!-- Header -->
  <div class="mb-4 flex-shrink-0">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-xl sm:text-2xl font-bold xpb-text-primary mb-1">Categorías</h1>
        <p class="xpb-text-secondary text-sm">Gestiona las categorías de tus transacciones</p>
      </div>
      <button 
        (click)="openCategoryEditionModal()"
        class="flex items-center gap-2 px-4 py-2.5 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors shadow-sm"
        type="button">
        <span class="material-icons text-lg">add</span>
        <span class="hidden sm:inline">Nueva Categoría</span>
        <span class="sm:hidden">Nueva</span>
      </button>
    </div>
  </div>

  <!-- Summary Card -->
  <app-summary-card
    class="mb-4 flex-shrink-0"
    [isLoading]="categoryState.isLoading()"
    [titleCard]="'Total de Categorías'"
    [contentCard]="categoryState.categories().length.toString()"
    [subtitleCard]="
      activeCategoriesCount() > 1 ? activeCategoriesCount() + ' categorías activas' :
      activeCategoriesCount() === 1 ? activeCategoriesCount() + ' categoría activa' :
      'Ninguna categoría activa'
    "
    [iconCard]="'category'"
    [contentClassCard]="'xpb-text-primary'"
  ></app-summary-card>

  <!-- Categories List -->
  <div class="flex-1 overflow-hidden">
    <div class="h-full overflow-y-auto pr-2">
      @if (categoryState.isLoading()) {
        <div class="flex items-center justify-center py-16">
          <div class="text-center">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 xpb-border border-t-[var(--xpb-primary)] mb-4"></div>
            <p class="xpb-text-secondary">Cargando categorías...</p>
          </div>
        </div>
      } @else if (categoryState.error()) {
        <div class="flex items-center justify-center py-16">
          <div class="text-center max-w-md">
            <div class="xpb-bg-main rounded-full flex items-center justify-center mx-auto mb-2">
              <span class="material-icons text-5xl text-[var(--xpb-expense)]">error_outline</span>
            </div>
            <h3 class="text-lg font-semibold xpb-text-primary ">Error al cargar</h3>
            <p class="xpb-text-secondary">No se encontraron categorías</p>
            <button type="button"
              (click)="reloadCategories()" 
              class="inline-block text-[var(--xpb-primary)] rounded-lg font-medium transition-colors text-sm">
              Reintentar
            </button>
          </div>
        </div>
      } @else if (categoryState.categories().length === 0) {
        <div class="flex items-center justify-center py-16">
          <div class="text-center max-w-md">
            <div class="xpb-bg-main rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
              <span class="material-icons text-5xl xpb-text-secondary">category</span>
            </div>
            <h3 class="text-lg font-semibold xpb-text-primary mb-2">No hay categorías</h3>
            <p class="xpb-text-secondary mb-6">Comienza creando tu primera categoría para organizar tus transacciones</p>
            <button 
              (click)="openCategoryEditionModal()"
              class="inline-flex items-center gap-2 px-6 py-3 bg-[var(--xpb-primary)] hover:bg-[var(--xpb-primary-hover)] text-white rounded-lg font-medium transition-colors shadow-sm">
              <span class="material-icons">add</span>
              <span>Crear Primera Categoría</span>
            </button>
          </div>
        </div>
      } @else {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 pb-4">
          @for (category of categoryState.categories(); track category.resourceCode) {
            <app-category-card ngSkipHydration 
              class="block"
              [categoryCardName]="category.name"
              [categoryCardColor]="category.color"
              [categoryCardState]="category.state"
              [categoryCardResourceCode]="category.resourceCode"
              [categoryTotalUses]="category.usageCount"
              (categoryCardEdit)="openCategoryEditionModal($event)">
            </app-category-card>
          }
        </div>
      }
    </div>
  </div>
</div>

@if (showCategoryEditionModal()) {
    <app-category-edition-modal 
        (close)="closeCategoryEditionModal()" 
        [resourceCodeSelected]="resourceCodeCategorySelected()">
    </app-category-edition-modal>
}